# üîç –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó –ö–û–î–ê: old vs new

## üìä –°–í–û–î–ö–ê –ê–ù–ê–õ–ò–ó–ê

–ü–æ—Å–ª–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ –∫–æ–¥–∞ (`old/`) —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π (`table/`) –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –∏ –ø–æ—Ç–µ—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**.

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –í –ù–û–í–û–ô –í–ï–†–°–ò–ò

### 1. **–†–ê–ó–†–´–í –õ–û–ì–ò–ö–ò –õ–ò–¶–ï–ù–ó–ò–†–û–í–ê–ù–ò–Ø**

#### –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (old/Main.txt):
```javascript
// –õ–∏—Ü–µ–Ω–∑–∏—è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê –≤—Å–µ–≥–¥–∞
var _email = getLicenseEmail();
var _token = getLicenseToken();
if (!_email || !_token) {
  addLog('üö´ –û—Ç–∫–∞–∑: –ª–∏—Ü–µ–Ω–∑–∏—è –Ω–µ –∑–∞–¥–∞–Ω–∞', 'WARN');
  return 'Error: LICENSE_REQUIRED';
}
```

#### –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è (table/client/GeminiClient.gs):
```javascript
// –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏—Ü–µ–Ω–∑–∏–∏ –≤–æ–æ–±—â–µ!
function GM(prompt, maxTokens, temperature) {
  // –°—Ä–∞–∑—É –∏–¥—ë—Ç –∫ Gemini API –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫
  var apiKey = getGeminiApiKey();
  // ...
}
```

**üî• –ö–†–ò–¢–ò–ß–ù–û**: –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è **–ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞–ª–∞ —Å–∏—Å—Ç–µ–º—É –ª–∏—Ü–µ–Ω–∑–∏–π**, —á—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!

### 2. **–ü–û–¢–ï–†–Ø –°–ï–†–í–ï–†–ù–û–ì–û –ü–†–û–ö–°–ò**

#### –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–∫—Å–∏ `SERVER_URL` –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Rate limiting –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞

#### –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:
- –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Gemini API
- –ù–µ—Ç rate limiting
- –ù–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è
- –ü–æ—Ç–µ—Ä—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### 3. **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ï –ö–û–ù–°–¢–ê–ù–¢–´**

#### table/shared/Constants.gs:
```javascript
const SERVER_API_URL = 'https://script.google.com/macros/s/AKfycby_YOUR_SERVER_ID/exec';
```

**üî• –û–®–ò–ë–ö–ê**: URL —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–ª—É—à–∫—É `YOUR_SERVER_ID` –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ ID!

–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –∏–∑ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏:
```javascript
const SERVER_URL = 'https://script.google.com/macros/s/AKfycbyyUlB5YWP4bwv3gHHniTv_12cAHlqjYfra7fQ3m3Vri5XvZTQ_uUZZovCYeTo2_u6gQw/exec';
```

### 4. **–£–í–ï–õ–ò–ß–ï–ù–ù–´–ï –õ–ò–ú–ò–¢–´ –ë–ï–ó –û–ë–û–°–ù–û–í–ê–ù–ò–Ø**

#### –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è:
```javascript
maxTokens = 25000;  // –†–∞–∑—É–º–Ω—ã–π –ª–∏–º–∏—Ç
```

#### –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:
```javascript
maxTokens = maxTokens || 250000;  // –£–≤–µ–ª–∏—á–µ–Ω–æ –≤ 10 —Ä–∞–∑!
```

**üî• –ü–†–û–ë–õ–ï–ú–ê**: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –≤ 10 —Ä–∞–∑ –±–µ–∑ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏—é –∫–≤–æ—Ç API
- –ë–æ–ª—å—à–∏–º —Ä–∞—Å—Ö–æ–¥–∞–º
- –ú–µ–¥–ª–µ–Ω–Ω—ã–º –æ—Ç–≤–µ—Ç–∞–º

### 5. **–û–¢–°–£–¢–°–¢–í–£–ï–¢ –°–ò–°–¢–ï–ú–ê RETRY**

#### –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è:
- –§—É–Ω–∫—Ü–∏—è `fetchGeminiWithRetry()` –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

#### –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:
- –û–±—ã—á–Ω—ã–π `UrlFetchApp.fetch()` –±–µ–∑ retry
- –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–±–æ–µ–≤ —Å–µ—Ç–∏
- –ú–æ–∂–µ—Ç –ø–∞–¥–∞—Ç—å –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö API

### 6. **–ù–ï–ü–û–õ–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø**

#### –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è:
```javascript
function addLog(msg, level = 'INFO') {
  // –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –∫—ç—à–æ–º, TTL, —ç–∫—Å–ø–æ—Ä—Ç–æ–º
}
```

#### –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:
```javascript  
function addSystemLog(message, level, category) {
  // –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ –º–Ω–æ–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
}
```

**–ü–æ—Ç–µ—Ä–∏**:
- –ù–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –ª–æ–≥–æ–≤
- –ù–µ—Ç UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
- –£–ø—Ä–æ—â—ë–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### 7. **–ü–û–¢–ï–†–Ø –§–£–ù–ö–¶–ò–ô OCR V2**

#### –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (old/ocrRunV2_client.txt):
- –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ OCR —Å –±–∞—Ç—á–∏–Ω–≥–æ–º
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –§–æ–ª–±—ç–∫ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- Chunking –¥–ª—è –±–æ–ª—å—à–∏—Ö –±–∞—Ç—á–µ–π

#### –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:
- –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è OCR
- –ú–µ–Ω—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ù–µ—Ç –±–∞—Ç—á–∏–Ω–≥–∞

---

## ‚úÖ –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ client/server/shared
- –ë–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫
- –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∫–æ–¥–∞

### 2. **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- API —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–µ–±–∞
- –õ—É—á—à–∏–π UX

### 3. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**
- –†–µ–∂–∏–º —á–∞—Ç–∞
- –£–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
- –ë–æ–ª—å—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

---

## üîß –ù–ï–û–ë–•–û–î–ò–ú–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö–†–ò–¢–ò–ß–ù–û):
1. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ª–∏—Ü–µ–Ω–∑–∏–π** –≤ GM —Ñ—É–Ω–∫—Ü–∏—è—Ö
2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å SERVER_API_URL** –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. **–í–µ—Ä–Ω—É—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–∫—Å–∏** –¥–ª—è Gemini –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É retry** –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–ê–ñ–ù–û):
1. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**
2. **–í–µ—Ä–Ω—É—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –ª–æ–≥–æ–≤**
3. **–î–æ–±–∞–≤–∏—Ç—å rate limiting**
4. **–ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–∏–º–∏—Ç—ã —Ç–æ–∫–µ–Ω–æ–≤**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–ï–õ–ê–¢–ï–õ–¨–ù–û):
1. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å OCR V2** –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
2. **–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É**
3. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**

---

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
1. **–ù–ï –¥–µ–ø–ª–æ–∏—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é** –±–µ–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é** –¥–ª—è production –¥–æ —Ñ–∏–∫—Å–æ–≤
3. **–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. **–í–∑—è—Ç—å –ª—É—á—à–µ–µ –∏–∑ –æ–±–µ–∏—Ö –≤–µ—Ä—Å–∏–π**
2. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**
3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏–∑ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏**
4. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–π**

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ **–æ—Ç–ª–∏—á–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ**, –Ω–æ –∏–º–µ–µ—Ç **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**. –û—Å–Ω–æ–≤–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏–∏ (–ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å) –±—ã–ª–∏ –ø–æ—Ç–µ—Ä—è–Ω—ã –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ.

**–°—Ç–∞—Ç—É—Å**: ‚ùå **–ù–ï –≥–æ—Ç–æ–≤–æ –¥–ª—è production**
**–î–µ–π—Å—Ç–≤–∏–µ**: üîß **–¢—Ä–µ–±—É—é—Ç—Å—è —Å—Ä–æ—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

*–≠—Ç–æ—Ç –∞–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞, –∞ –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.*