name: ðŸš€ Auto Deploy to Google Apps Script

on:
  push:
    branches:
      - web-interface-with-design
    paths:
      - 'table/**'
  workflow_dispatch:

jobs:
  deploy:
    name: Deploy to Apps Script
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: ðŸ“¦ Install clasp
        run: npm install -g @google/clasp
      
      - name: ðŸ” Setup clasp credentials
        run: |
          echo "${{ secrets.CLASPRC_JSON }}" > ~/.clasprc.json
          echo "âœ… Credentials configured"
      
      - name: ðŸš€ Deploy Server Project
        working-directory: table
        run: |
          echo "ðŸ“¤ Deploying server files..."
          cp .clasp-server.json .clasp.json
          clasp push -f
          echo "âœ… Server deployment complete"
      
      - name: ðŸš€ Deploy Client Project
        working-directory: table
        run: |
          echo "ðŸ“¤ Deploying client files (client + shared)..."
          cp .clasp-client.json .clasp.json
          clasp push -f
          echo "âœ… Client deployment complete"
      
      - name: ðŸŽ‰ Deployment Summary
        run: |
          echo "### âœ… Deployment Successful" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Deployed projects:**" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ–¥ï¸ Server (API endpoints)" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ“± Client (UI + shared utilities)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Branch:** \`${{ github.ref_name }}\`" >> $GITHUB_STEP_SUMMARY
          echo "**Commit:** \`${{ github.sha }}\`" >> $GITHUB_STEP_SUMMARY
