# üîç VK_REVIEWS_REGEX - –ü–û–î–†–û–ë–ù–û–ï –û–ë–™–Ø–°–ù–ï–ù–ò–ï

## ‚ùì **–¢–´ –°–ü–†–û–°–ò–õ: "–ü–æ—á–µ–º—É –≤ Script Properties? –Ø –¥—É–º–∞–ª —ç—Ç–æ –º–µ—Ç–æ–¥ –∑–∞–ø—Ä–æ—Å–∞ VK?"**

**–ö–û–†–û–¢–ö–ò–ô –û–¢–í–ï–¢:**  
`getReviewsRegex_()` - —ç—Ç–æ –ù–ï –∑–∞–ø—Ä–æ—Å –∫ VK API!  
–≠—Ç–æ **regex –¥–ª—è –§–ò–õ–¨–¢–†–ê–¶–ò–ò** —Ç–µ–º –æ–±—Å—É–∂–¥–µ–Ω–∏–π.

---

## üéØ **–ß–¢–û –≠–¢–û –¢–ê–ö–û–ï?**

### **–ü—Ä–æ–±–ª–µ–º–∞:**
–í VK –≥—Ä—É–ø–ø–∞—Ö –µ—Å—Ç—å **–æ–±—Å—É–∂–¥–µ–Ω–∏—è** (—Ç–µ–º—ã –Ω–∞ —Ñ–æ—Ä—É–º–µ –≥—Ä—É–ø–ø—ã).  
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–º—ã - —ç—Ç–æ **–æ—Ç–∑—ã–≤—ã**, –¥—Ä—É–≥–∏–µ - –æ–±—ã—á–Ω—ã–µ —Ç–µ–º—ã.

**–ü—Ä–∏–º–µ—Ä—ã —Ç–µ–º:**
- ‚úÖ "–û—Ç–∑—ã–≤—ã –æ —Ä–∞–±–æ—Ç–µ" - –≠–¢–û –æ—Ç–∑—ã–≤
- ‚úÖ "Reviews and feedback" - –≠–¢–û –æ—Ç–∑—ã–≤
- ‚úÖ "–†–µ–π—Ç–∏–Ω–≥ –Ω–∞—à–∏—Ö —É—Å–ª—É–≥" - –≠–¢–û –æ—Ç–∑—ã–≤
- ‚ùå "–ù–æ–≤–æ—Å—Ç–∏ –∫–æ–º–ø–∞–Ω–∏–∏" - –ù–ï –æ—Ç–∑—ã–≤
- ‚ùå "–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã" - –ù–ï –æ—Ç–∑—ã–≤

**–ö–∞–∫ –æ—Ç–ª–∏—á–∏—Ç—å?**  
‚Üí –ü–æ **–Ω–∞–∑–≤–∞–Ω–∏—é —Ç–µ–º—ã**! –ò—â–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞.

---

## üìã **–ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢?**

### **–®–∞–≥ 1: VK API –∑–∞–ø—Ä–æ—Å - –ø–æ–ª—É—á–∞–µ–º –í–°–ï —Ç–µ–º—ã**

```javascript
// –ó–∞–ø—Ä–æ—Å –∫ VK API: board.getTopics
var topicsApi = 'https://api.vk.com/method/board.getTopics'
  + '?group_id=' + groupId
  + '&order=2&count=200'
  + '&access_token=' + token
  + '&v=5.131';

var response = UrlFetchApp.fetch(topicsApi);
var topics = JSON.parse(response).response.items;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```javascript
[
  { id: 123, title: "–û—Ç–∑—ã–≤—ã –æ —Ä–∞–±–æ—Ç–µ", comments: 45 },
  { id: 124, title: "–ù–æ–≤–æ—Å—Ç–∏ –∫–æ–º–ø–∞–Ω–∏–∏", comments: 12 },
  { id: 125, title: "Reviews and feedback", comments: 67 },
  { id: 126, title: "–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã", comments: 23 }
]
```

### **–®–∞–≥ 2: getReviewsRegex_() - –ø–æ–ª—É—á–∞–µ–º regex –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**

```javascript
function getReviewsRegex_() {
  // –ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏–∑ Script Properties
  var customRegex = PropertiesService.getScriptProperties().getProperty('VK_REVIEWS_REGEX');
  
  if (customRegex && customRegex.trim()) {
    return new RegExp(customRegex, 'i'); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π
  }
  
  // –ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ–º default
  return /(–æ—Ç–∑—ã–≤|reviews?|feedback|—Ä–µ–π—Ç–∏–Ω–≥|–æ—Ü–µ–Ω–∫|–∑–≤–µ–∑–¥)/i;
}
```

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**
- Regex: `/(–æ—Ç–∑—ã–≤|reviews?|feedback|—Ä–µ–π—Ç–∏–Ω–≥|–æ—Ü–µ–Ω–∫|–∑–≤–µ–∑–¥)/i`
- `/` - –Ω–∞—á–∞–ª–æ regex
- `(...)` - –≥—Ä—É–ø–ø–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- `|` - –ò–õ–ò
- `reviews?` - "review" –∏–ª–∏ "reviews" (? = –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `i` - —Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ (case-insensitive)

### **–®–∞–≥ 3: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–µ–º –ø–æ regex**

```javascript
var regex = getReviewsRegex_(); // –ü–æ–ª—É—á–∏–ª–∏ regex

// –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–º—ã —Å –æ—Ç–∑—ã–≤–∞–º–∏
topics = topics.filter(function(topic) {
  return regex.test(topic.title); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã
});
```

**–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:**
```javascript
[
  { id: 123, title: "–û—Ç–∑—ã–≤—ã –æ —Ä–∞–±–æ—Ç–µ", comments: 45 },      // ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç
  { id: 125, title: "Reviews and feedback", comments: 67 }  // ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç
  // "–ù–æ–≤–æ—Å—Ç–∏" –∏ "–í–æ–ø—Ä–æ—Å—ã" –æ—Ç–±—Ä–æ—à–µ–Ω—ã ‚ùå
]
```

### **–®–∞–≥ 4: –ü–∞—Ä—Å–∏–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¢–û–õ–¨–ö–û –∏–∑ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ–º**

```javascript
// –î–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã —Å –æ—Ç–∑—ã–≤–∞–º–∏ - –ø–æ–ª—É—á–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
for (var i = 0; i < topics.length; i++) {
  var topicId = topics[i].id;
  
  // –ó–∞–ø—Ä–æ—Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–∑ –≠–¢–û–ô —Ç–µ–º—ã
  var commentsApi = 'https://api.vk.com/method/board.getComments'
    + '?group_id=' + groupId
    + '&topic_id=' + topicId
    + '&access_token=' + token;
  
  var comments = UrlFetchApp.fetch(commentsApi);
  // ... —Å–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç—ã –æ—Ç–∑—ã–≤–æ–≤
}
```

---

## üéØ **–ó–ê–ß–ï–ú –í SCRIPT PROPERTIES?**

### **–ü—Ä–∏—á–∏–Ω–∞ 1: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ—Å—Ç—å**

–†–∞–∑–Ω—ã–µ –≥—Ä—É–ø–ø—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç **—Ä–∞–∑–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è** –¥–ª—è —Ç–µ–º —Å –æ—Ç–∑—ã–≤–∞–º–∏:
- "–û—Ç–∑—ã–≤—ã"
- "–ö–Ω–∏–≥–∞ –∂–∞–ª–æ–±"
- "–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å"
- "Customer feedback"
- "Testimonials"

**–ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å regex –ø–æ–¥ —Å–≤–æ—é –≥—Ä—É–ø–ø—É:**
```javascript
// –í Script Properties –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
VK_REVIEWS_REGEX = "(–æ—Ç–∑—ã–≤|book of complaints|–æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å)"
```

### **–ü—Ä–∏—á–∏–Ω–∞ 2: –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞**

–ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ñ–∏–ª—å—Ç—Ä **–ë–ï–ó –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞–Ω–∏—è** –∫–æ–¥–∞:
- –î–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—É—é —Ç–µ–º—É "–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏" ‚Üí –æ–±–Ω–æ–≤–∏–ª–∏ regex
- –ò–∑–º–µ–Ω–∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã ‚Üí –æ–±–Ω–æ–≤–∏–ª–∏ regex
- –ù–ï –Ω—É–∂–µ–Ω —Ä–µ–¥–µ–ø–ª–æ–π!

### **–ü—Ä–∏—á–∏–Ω–∞ 3: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

Regex —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ **—Å–µ—Ä–≤–µ—Ä–µ** (–Ω–µ –≤ –∫–ª–∏–µ–Ω—Ç–µ):
- –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –≤–∏–¥—è—Ç –ª–æ–≥–∏–∫—É —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

---

## üìù **–ì–î–ï –≠–¢–û –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø?**

**–§–∞–π–ª:** `old/VK_PARSER.txt` (–∏–∑ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏)

**–§—É–Ω–∫—Ü–∏—è:** `handleParseReviews_(e)`

```javascript
function handleParseReviews_(e) {
  var url = e.parameter.url;
  var limit = parseInt(e.parameter.limit || '100', 10);
  var offset = parseInt(e.parameter.offset || '0', 10);
  
  if (!url) return json_({ error: '–ù–µ —É–∫–∞–∑–∞–Ω url reviews-—Å—Ç—Ä–∞–Ω–∏—Ü—ã' });
  
  var token = getVkToken_();
  var v = '5.131';
  
  // –ò–∑–≤–ª–µ–∫–∞–µ–º group_id –∏–∑ URL
  var m = String(url).match(/vk\\.com\\/reviews-([0-9]+)/i);
  if (!m) return json_({ error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL reviews-—Å—Ç—Ä–∞–Ω–∏—Ü—ã' });
  
  var groupId = parseInt(m[1], 10);

  // ====== –í–û–¢ –ó–î–ï–°–¨ –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø! ======
  var regex = getReviewsRegex_(); // –ü–æ–ª—É—á–∞–µ–º regex
  
  // 1) –ü–æ–ª—É—á–∞–µ–º —Ç–µ–º—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π
  var topicsApi = 'https://api.vk.com/method/board.getTopics'
    + '?group_id=' + groupId
    + '&order=2&count=200'
    + '&access_token=' + token
    + '&v=' + v;
    
  var tRes = UrlFetchApp.fetch(topicsApi);
  var topics = JSON.parse(tRes.getContentText()).response.items;
  
  // 2) –§–ò–õ–¨–¢–†–£–ï–ú –ø–æ regex!
  topics = topics.filter(function(tp) { 
    return regex.test(String(tp.title || '')); // ‚Üê –ó–î–ï–°–¨!
  });
  
  if (!topics.length) {
    return json_({ texts: [], hasMore: false, total: 0 });
  }

  // 3) –ü–∞—Ä—Å–∏–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –∏–∑ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ–º
  // ...
}
```

---

## üîß **–ö–ê–ö –ù–ê–°–¢–†–û–ò–¢–¨?**

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å default (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)**

–ù–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ! Default regex –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–ª—É—á–∞–µ–≤:
```
/(–æ—Ç–∑—ã–≤|reviews?|feedback|—Ä–µ–π—Ç–∏–Ω–≥|–æ—Ü–µ–Ω–∫|–∑–≤–µ–∑–¥)/i
```

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π regex**

1. –û—Ç–∫—Ä–æ–π Google Apps Script **—Å–µ—Ä–≤–µ—Ä–∞**
2. Project Settings ‚Üí Script Properties
3. –î–æ–±–∞–≤—å:
   ```
   –ö–ª—é—á: VK_REVIEWS_REGEX
   –ó–Ω–∞—á–µ–Ω–∏–µ: (–æ—Ç–∑—ã–≤|–∫–Ω–∏–≥–∞ –∂–∞–ª–æ–±|–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏)
   ```

4. –¢–µ–ø–µ—Ä—å –±—É–¥—É—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å—Å—è —Ç–µ–º—ã —Å —ç—Ç–∏–º–∏ —Å–ª–æ–≤–∞–º–∏!

---

## üéØ **–ò–¢–û–ì**

### **getReviewsRegex_() - —ç—Ç–æ:**
- ‚úÖ **–ù–ï –∑–∞–ø—Ä–æ—Å –∫ VK API**
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è regex
- ‚úÖ –ß–∏—Ç–∞–µ—Ç –∏–∑ Script Properties (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ)
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç default –µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–§–ò–õ–¨–¢–†–ê–¶–ò–ò** —Ç–µ–º –æ–±—Å—É–∂–¥–µ–Ω–∏–π
- ‚úÖ –ü–æ–º–æ–≥–∞–µ—Ç –Ω–∞–π—Ç–∏ **–¢–û–õ–¨–ö–û —Ç–µ–º—ã —Å –æ—Ç–∑—ã–≤–∞–º–∏**

### **–ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å:**
```
1. VK API: board.getTopics ‚Üí –í—Å–µ —Ç–µ–º—ã –≥—Ä—É–ø–ø—ã
2. getReviewsRegex_() ‚Üí –ü–æ–ª—É—á–∏–ª–∏ regex
3. topics.filter(regex.test) ‚Üí –û—Å—Ç–∞–≤–∏–ª–∏ —Ç–æ–ª—å–∫–æ —Ç–µ–º—ã —Å –æ—Ç–∑—ã–≤–∞–º–∏
4. VK API: board.getComments ‚Üí –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ–º
5. –†–µ–∑—É–ª—å—Ç–∞—Ç: –¢–µ–∫—Å—Ç—ã –æ—Ç–∑—ã–≤–æ–≤
```

### **–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è:**
- ‚úÖ Script Properties **–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**
- ‚úÖ –ù–ï –≤ –∫–ª–∏–µ–Ω—Ç–µ
- ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –æ–¥–∏–Ω —Ä–∞–∑

---

## üí° **–ü–†–ò–ú–ï–†–´ REGEX**

### **Default (—Ä—É—Å—Å–∫–∏–π + –∞–Ω–≥–ª–∏–π—Å–∫–∏–π):**
```regex
/(–æ—Ç–∑—ã–≤|reviews?|feedback|—Ä–µ–π—Ç–∏–Ω–≥|–æ—Ü–µ–Ω–∫|–∑–≤–µ–∑–¥)/i
```

### **–¢–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π:**
```regex
/(–æ—Ç–∑—ã–≤|–∫–Ω–∏–≥–∞ –∂–∞–ª–æ–±|–æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å|—Ä–µ–π—Ç–∏–Ω–≥)/i
```

### **–¢–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π:**
```regex
/(review|feedback|testimonial|rating)/i
```

### **–ö–∞—Å—Ç–æ–º–Ω—ã–π (—Å –Ω–æ–º–µ—Ä–∞–º–∏):**
```regex
/(–æ—Ç–∑—ã–≤|review|—Ç–µ–º–∞.*[0-9]+.*–æ—Ç–∑—ã–≤)/i
```

---

**–¢–µ–ø–µ—Ä—å –ø–æ–Ω—è—Ç–Ω–æ? üéØ‚ú®**
