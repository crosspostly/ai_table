<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>ü§ñ Table AI Bot - –í–µ–± –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Modern CSS Framework -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
        }
        
        .btn-secondary {
            background: rgba(107, 114, 128, 0.1);
            color: #374151;
            border: 1px solid rgba(107, 114, 128, 0.2);
            padding: 10px 20px;
            border-radius: 6px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .status-ok { color: #10b981; }
        .status-error { color: #ef4444; }
        .status-warning { color: #f59e0b; }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #10b981, #059669);
            transition: width 0.3s ease;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            border-bottom-color: #4f46e5;
            color: #4f46e5;
            font-weight: 600;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }
        
        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success { background: #10b981; }
        .notification.error { background: #ef4444; }
        .notification.info { background: #3b82f6; }
        
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        th {
            background: #f9fafb;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .metric-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4f46e5;
            margin-bottom: 8px;
        }
        
        .metric-label {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading {
            animation: spin 1s linear infinite;
        }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="glass text-white p-4 mb-6">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center">
                <i class="fas fa-robot text-3xl mr-3"></i>
                <div>
                    <h1 class="text-xl font-bold">Table AI Bot</h1>
                    <p class="text-sm opacity-80">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div id="connectionStatus" class="flex items-center">
                    <i class="fas fa-circle text-green-400 mr-2"></i>
                    <span class="text-sm">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
                </div>
                <button onclick="refreshData()" class="btn-secondary">
                    <i class="fas fa-sync mr-2"></i>–û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4">
        <!-- Navigation Tabs -->
        <div class="card p-0 mb-6">
            <div class="flex overflow-x-auto">
                <div class="tab active" onclick="showTab('dashboard')">
                    <i class="fas fa-tachometer-alt mr-2"></i>–î–∞—à–±–æ—Ä–¥
                </div>
                <div class="tab" onclick="showTab('social-import')">
                    <i class="fas fa-share mr-2"></i>–°–æ—Ü–∏–∞–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç
                </div>
                <div class="tab" onclick="showTab('ocr-analysis')">
                    <i class="fas fa-eye mr-2"></i>OCR –∞–Ω–∞–ª–∏–∑
                </div>
                <div class="tab" onclick="showTab('gemini-chat')">
                    <i class="fas fa-comments mr-2"></i>Gemini —á–∞—Ç
                </div>
                <div class="tab" onclick="showTab('data-viewer')">
                    <i class="fas fa-table mr-2"></i>–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
                </div>
                <div class="tab" onclick="showTab('ai-constructor')">
                    <i class="fas fa-magic mr-2"></i>AI –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
                </div>
                <div class="tab" onclick="showTab('settings')">
                    <i class="fas fa-cog mr-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="tab-dashboard" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="metric-card">
                    <div class="metric-number" id="totalPosts">-</div>
                    <div class="metric-label">–í—Å–µ–≥–æ –ø–æ—Å—Ç–æ–≤</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="totalReviews">-</div>
                    <div class="metric-label">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –æ—Ç–∑—ã–≤–æ–≤</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number status-ok" id="systemHealth">98%</div>
                    <div class="metric-label">–†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="todayActivity">-</div>
                    <div class="metric-label">–û–ø–µ—Ä–∞—Ü–∏–π —Å–µ–≥–æ–¥–Ω—è</div>
                </div>
            </div>

            <!-- System Status -->
            <div class="card p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">
                    <i class="fas fa-server mr-2"></i>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="flex items-center">
                        <i id="credentialsIcon" class="fas fa-key mr-3 text-lg"></i>
                        <div>
                            <div class="font-medium">Credentials</div>
                            <div id="credentialsStatus" class="text-sm text-gray-600">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <i id="sheetsIcon" class="fas fa-table mr-3 text-lg"></i>
                        <div>
                            <div class="font-medium">Google Sheets</div>
                            <div id="sheetsStatus" class="text-sm text-gray-600">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <i id="serverIcon" class="fas fa-cloud mr-3 text-lg"></i>
                        <div>
                            <div class="font-medium">–í–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä</div>
                            <div id="serverStatus" class="text-sm text-gray-600">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card p-6">
                <h3 class="text-lg font-semibold mb-4">
                    <i class="fas fa-history mr-2"></i>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                </h3>
                <div id="recentActivity" class="space-y-3">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                </div>
            </div>
        </div>

        <!-- Social Import Tab -->
        <div id="tab-social-import" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card p-6">
                    <h3 class="text-lg font-semibold mb-4">
                        <i class="fas fa-download mr-2"></i>–ò–º–ø–æ—Ä—Ç –ø–æ—Å—Ç–æ–≤
                    </h3>
                    <form id="socialImportForm">
                        <div class="input-group">
                            <label>–ò—Å—Ç–æ—á–Ω–∏–∫ (URL –∏–ª–∏ ID)</label>
                            <input type="text" id="socialSource" placeholder="https://instagram.com/nasa –∏–ª–∏ @durov" required>
                            <div class="text-sm text-gray-600 mt-1">
                                –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: Instagram, VK, Telegram
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤</label>
                            <input type="number" id="socialCount" value="10" min="1" max="50" required>
                        </div>
                        
                        <div class="input-group">
                            <label>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                            <select id="socialPlatform">
                                <option value="">–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</option>
                                <option value="instagram">Instagram</option>
                                <option value="vk">VKontakte</option>
                                <option value="telegram">Telegram</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn-primary w-full">
                            <i class="fas fa-play mr-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç
                        </button>
                    </form>
                </div>
                
                <div class="card p-6">
                    <h3 class="text-lg font-semibold mb-4">
                        <i class="fas fa-info-circle mr-2"></i>–°—Ç–∞—Ç—É—Å –∏–º–ø–æ—Ä—Ç–∞
                    </h3>
                    <div id="importStatus" class="space-y-3">
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-inbox text-3xl mb-3"></i>
                            <p>–ò–º–ø–æ—Ä—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- OCR Analysis Tab -->
        <div id="tab-ocr-analysis" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card p-6">
                    <h3 class="text-lg font-semibold mb-4">
                        <i class="fas fa-search mr-2"></i>OCR –∞–Ω–∞–ª–∏–∑ –æ—Ç–∑—ã–≤–æ–≤
                    </h3>
                    <form id="ocrAnalysisForm">
                        <div class="input-group">
                            <label class="flex items-center">
                                <input type="checkbox" id="ocrOverwrite" class="mr-3">
                                –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                            </label>
                            <div class="text-sm text-gray-600 mt-1">
                                –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ, –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ —Å—Ç—Ä–æ–∫–∏. –ò–Ω–∞—á–µ —Ç–æ–ª—å–∫–æ –ø—É—Å—Ç—ã–µ.
                            </div>
                        </div>
                        
                        <button type="submit" class="btn-primary w-full">
                            <i class="fas fa-eye mr-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å OCR –∞–Ω–∞–ª–∏–∑
                        </button>
                    </form>
                </div>
                
                <div class="card p-6">
                    <h3 class="text-lg font-semibold mb-4">
                        <i class="fas fa-chart-bar mr-2"></i>–ü—Ä–æ–≥—Ä–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞
                    </h3>
                    <div id="ocrProgress" class="space-y-3">
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-image text-3xl mb-3"></i>
                            <p>–ê–Ω–∞–ª–∏–∑ –Ω–µ –∑–∞–ø—É—â–µ–Ω</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gemini Chat Tab -->
        <div id="tab-gemini-chat" class="tab-content hidden">
            <div class="card p-6">
                <h3 class="text-lg font-semibold mb-4">
                    <i class="fas fa-robot mr-2"></i>Gemini AI –ß–∞—Ç
                </h3>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="input-group">
                            <label>–í–∞—à –∑–∞–ø—Ä–æ—Å</label>
                            <textarea id="geminiPrompt" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è Gemini AI..."></textarea>
                        </div>
                        
                        <div class="flex space-x-4 mb-4">
                            <button onclick="sendGeminiRequest()" class="btn-primary">
                                <i class="fas fa-paper-plane mr-2"></i>–û—Ç–ø—Ä–∞–≤–∏—Ç—å
                            </button>
                            <button onclick="clearGeminiChat()" class="btn-secondary">
                                <i class="fas fa-trash mr-2"></i>–û—á–∏—Å—Ç–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="input-group">
                            <label>–ú–∞–∫—Å. —Ç–æ–∫–µ–Ω–æ–≤</label>
                            <input type="number" id="geminiMaxTokens" value="1000" min="100" max="8000">
                        </div>
                        <div class="input-group">
                            <label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</label>
                            <input type="number" id="geminiTemperature" value="0.7" min="0" max="1" step="0.1">
                        </div>
                    </div>
                </div>
                
                <div id="geminiResponse" class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-8 min-h-32">
                    <div class="text-center text-gray-500">
                        <i class="fas fa-comments text-2xl mb-2"></i>
                        <p>–û—Ç–≤–µ—Ç—ã Gemini –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Viewer Tab -->
        <div id="tab-data-viewer" class="tab-content hidden">
            <div class="card p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">
                        <i class="fas fa-database mr-2"></i>–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
                    </h3>
                    <div class="flex space-x-2">
                        <select id="tableSelector" onchange="loadTableData()">
                            <option value="–ø–æ—Å—Ç—ã">–ü–æ—Å—Ç—ã</option>
                            <option value="–û—Ç–∑—ã–≤—ã">–û—Ç–∑—ã–≤—ã</option>
                            <option value="–ü–∞—Ä–∞–º–µ—Ç—Ä—ã">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</option>
                        </select>
                        <button onclick="loadTableData()" class="btn-secondary">
                            <i class="fas fa-sync mr-2"></i>–û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <div id="tableData" class="table-container">
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-table text-3xl mb-3"></i>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Constructor Tab -->\n        <div id="tab-ai-constructor" class="tab-content hidden">\n            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">\n                <div class="card p-6">\n                    <h3 class="text-lg font-semibold mb-4">\n                        <i class="fas fa-magic mr-2"></i>AI –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (–±–µ–∑ –ª–∏–º–∏—Ç–æ–≤)\n                    </h3>\n                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">\n                        <div class="flex items-center mb-2">\n                            <i class="fas fa-info-circle text-blue-500 mr-2"></i>\n                            <span class="font-medium text-blue-800">–ß—Ç–æ —ç—Ç–æ?</span>\n                        </div>\n                        <p class="text-blue-700 text-sm">\n                            AI –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–æ–π—Ç–∏ –ª–∏–º–∏—Ç Google Sheets –≤ 50,000 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è —Ñ–æ—Ä–º—É–ª. \n                            –î–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä—è–º–æ –≤ —è—á–µ–π–∫—É.\n                        </p>\n                    </div>\n                    \n                    <!-- Cell Information -->\n                    <div class="input-group">\n                        <label>–¶–µ–ª–µ–≤–∞—è —è—á–µ–π–∫–∞</label>\n                        <div class="flex space-x-2">\n                            <select id="aiTargetSheet" class="flex-1">\n                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏—Å—Ç...</option>\n                            </select>\n                            <input type="text" id="aiTargetCell" placeholder="A1" class="flex-none w-20">\n                        </div>\n                        <div class="text-sm text-gray-600 mt-1">\n                            –õ–∏—Å—Ç –∏ —è—á–µ–π–∫–∞, –≥–¥–µ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç AI –∑–∞–ø—Ä–æ—Å–∞\n                        </div>\n                    </div>\n\n                    <!-- System Prompt -->\n                    <div class="input-group">\n                        <label>System Prompt (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è AI)</label>\n                        <div class="flex space-x-2">\n                            <select id="aiSystemSheet" class="flex-1">\n                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏—Å—Ç...</option>\n                            </select>\n                            <input type="text" id="aiSystemCell" placeholder="A1" class="flex-none w-20">\n                        </div>\n                        <div class="text-sm text-gray-600 mt-1">\n                            –Ø—á–µ–π–∫–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –¥–ª—è AI (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ –∏ –¥–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏")\n                        </div>\n                    </div>\n\n                    <!-- User Data Sources -->\n                    <div class="input-group">\n                        <label class="flex items-center justify-between">\n                            <span>–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è AI</span>\n                            <button type="button" onclick="addDataSource()" class="btn-secondary text-sm px-3 py-1">\n                                <i class="fas fa-plus mr-1"></i>–î–æ–±–∞–≤–∏—Ç—å\n                            </button>\n                        </label>\n                        <div id="aiDataSources" class="space-y-2 border border-gray-200 rounded-lg p-3 min-h-20">\n                            <div class="text-sm text-gray-500 text-center py-2">\n                                –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å" —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Actions -->\n                    <div class="flex space-x-3">\n                        <button onclick="executeAIConstructor()" class="btn-primary flex-1">\n                            <i class="fas fa-play mr-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å AI\n                        </button>\n                        <button onclick="saveAIConfig()" class="btn-secondary">\n                            <i class="fas fa-save mr-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å\n                        </button>\n                        <button onclick="loadAIConfig()" class="btn-secondary">\n                            <i class="fas fa-upload mr-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å\n                        </button>\n                    </div>\n                </div>\n                \n                <div class="card p-6">\n                    <h3 class="text-lg font-semibold mb-4">\n                        <i class="fas fa-cogs mr-2"></i>–°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è\n                    </h3>\n                    <div id="aiConstructorStatus" class="space-y-3">\n                        <div class="text-center text-gray-500 py-8">\n                            <i class="fas fa-robot text-3xl mb-3"></i>\n                            <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å AI"</p>\n                        </div>\n                    </div>\n                    \n                    <!-- Configuration Preview -->\n                    <div class="mt-6">\n                        <h4 class="font-medium mb-3">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:</h4>\n                        <div id="aiConfigPreview" class="bg-gray-50 border rounded-lg p-3 text-sm">\n                            <div class="text-gray-500">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ –∑–¥–µ—Å—å</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Settings Tab -->
        <div id="tab-settings" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card p-6">
                    <h3 class="text-lg font-semibold mb-4">
                        <i class="fas fa-key mr-2"></i>API –ö–ª—é—á–∏
                    </h3>
                    <form id="settingsForm">
                        <div class="input-group">
                            <label>Email –ª–∏—Ü–µ–Ω–∑–∏–∏</label>
                            <input type="email" id="settingsEmail" placeholder="your@email.com">
                        </div>
                        
                        <div class="input-group">
                            <label>Token –ª–∏—Ü–µ–Ω–∑–∏–∏</label>
                            <input type="password" id="settingsToken" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω">
                        </div>
                        
                        <div class="input-group">
                            <label>Gemini API Key</label>
                            <input type="password" id="settingsGeminiKey" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á Gemini">
                        </div>
                        
                        <div class="input-group">
                            <label class="flex items-center">
                                <input type="checkbox" id="settingsOcrOverwrite" class="mr-3">
                                OCR: –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                            </label>
                        </div>
                        
                        <button type="submit" class="btn-primary w-full">
                            <i class="fas fa-save mr-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        </button>
                    </form>
                </div>
                
                <div class="card p-6">
                    <h3 class="text-lg font-semibold mb-4">
                        <i class="fas fa-tools mr-2"></i>–°–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
                    </h3>
                    <div class="space-y-3">
                        <button onclick="testConnection()" class="btn-secondary w-full">
                            <i class="fas fa-network-wired mr-2"></i>–¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                        </button>
                        <button onclick="exportData()" class="btn-secondary w-full">
                            <i class="fas fa-download mr-2"></i>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                        </button>
                        <button onclick="clearLogs()" class="btn-secondary w-full">
                            <i class="fas fa-broom mr-2"></i>–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="glass p-8 rounded-2xl text-white text-center">
            <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
            <div id="loadingMessage">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentTab = 'dashboard';
        let systemStatus = <?= JSON.stringify(systemStatus) ?>;
        let recentResults = <?= JSON.stringify(recentResults) ?>;
        let credentials = <?= JSON.stringify(credentials) ?>;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            initializeInterface();
            loadDashboardData();
            checkSystemStatus();
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function initializeInterface() {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
            if (credentials.email) {
                document.getElementById('settingsEmail').value = credentials.email;
            }
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º OCR checkbox
            document.getElementById('settingsOcrOverwrite').checked = systemStatus.ocrOverwrite;
            document.getElementById('ocrOverwrite').checked = systemStatus.ocrOverwrite;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º
            document.getElementById('socialImportForm').addEventListener('submit', handleSocialImport);
            document.getElementById('ocrAnalysisForm').addEventListener('submit', handleOcrAnalysis);
            document.getElementById('settingsForm').addEventListener('submit', handleSettingsSave);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            loadTableData();
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±—ã
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —Ç–∞–±
            document.getElementById('tab-' + tabName).classList.remove('hidden');
            event.target.closest('.tab').classList.add('active');
            
            currentTab = tabName;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞
        function loadDashboardData() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
            google.script.run
                .withSuccessHandler(function(data) {
                    if (data.success) {
                        document.getElementById('totalPosts').textContent = data.metrics.posts || '0';
                        document.getElementById('totalReviews').textContent = data.metrics.reviews || '0';
                        document.getElementById('todayActivity').textContent = data.metrics.activity || '0';
                    }
                })
                .webApiGetTableData('–ø–æ—Å—Ç—ã', 1000);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            updateRecentActivity();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        function updateRecentActivity() {
            const container = document.getElementById('recentActivity');
            container.innerHTML = '';
            
            if (!recentResults || recentResults.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-4">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
                return;
            }
            
            recentResults.forEach(result => {
                const item = document.createElement('div');
                item.className = 'flex items-center p-3 bg-gray-50 rounded-lg';
                item.innerHTML = `
                    <div class="flex-shrink-0 mr-4">
                        <i class="fas ${result.type === 'OCR' ? 'fa-eye' : 'fa-share'} text-lg text-blue-500"></i>
                    </div>
                    <div class="flex-grow min-w-0">
                        <div class="text-sm font-medium text-gray-900 truncate">${result.source}</div>
                        <div class="text-sm text-gray-500 truncate">${result.result}</div>
                    </div>
                    <div class="flex-shrink-0 text-xs text-gray-400">
                        –°—Ç—Ä–æ–∫–∞ ${result.row}
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã
        function checkSystemStatus() {
            // Credentials —Å—Ç–∞—Ç—É—Å
            const credIcon = document.getElementById('credentialsIcon');
            const credStatus = document.getElementById('credentialsStatus');
            
            if (systemStatus.credentialsOk) {
                credIcon.className = 'fas fa-key mr-3 text-lg status-ok';
                credStatus.textContent = '–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ';
            } else {
                credIcon.className = 'fas fa-key mr-3 text-lg status-error';
                credStatus.textContent = systemStatus.credentialsError || '–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ';
            }
            
            // Sheets —Å—Ç–∞—Ç—É—Å
            const sheetsIcon = document.getElementById('sheetsIcon');
            const sheetsStatus = document.getElementById('sheetsStatus');
            
            if (systemStatus.hasReviewsSheet && systemStatus.hasParamsSheet) {
                sheetsIcon.className = 'fas fa-table mr-3 text-lg status-ok';
                sheetsStatus.textContent = '–í—Å–µ –ª–∏—Å—Ç—ã –Ω–∞–π–¥–µ–Ω—ã';
            } else {
                sheetsIcon.className = 'fas fa-table mr-3 text-lg status-warning';
                sheetsStatus.textContent = '–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ª–∏—Å—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç';
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
        function handleSocialImport(e) {
            e.preventDefault();
            
            const params = {
                source: document.getElementById('socialSource').value,
                count: parseInt(document.getElementById('socialCount').value),
                platform: document.getElementById('socialPlatform').value
            };
            
            showLoading('–ó–∞–ø—É—Å–∫ –∏–º–ø–æ—Ä—Ç–∞...');
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        showNotification('–ò–º–ø–æ—Ä—Ç –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                        updateImportStatus('–í –ø—Ä–æ—Ü–µ—Å—Å–µ...');
                    } else {
                        showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
                })
                .webApiSocialImport(params);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ OCR –∞–Ω–∞–ª–∏–∑–∞
        function handleOcrAnalysis(e) {
            e.preventDefault();
            
            const params = {
                overwrite: document.getElementById('ocrOverwrite').checked
            };
            
            showLoading('–ó–∞–ø—É—Å–∫ OCR –∞–Ω–∞–ª–∏–∑–∞...');
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        showNotification('OCR –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!', 'success');
                        updateOcrProgress('–ó–∞–≤–µ—Ä—à–µ–Ω');
                    } else {
                        showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
                })
                .webApiOcrAnalysis(params);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function handleSettingsSave(e) {
            e.preventDefault();
            
            const settings = {
                email: document.getElementById('settingsEmail').value,
                token: document.getElementById('settingsToken').value,
                geminiKey: document.getElementById('settingsGeminiKey').value,
                ocrOverwrite: document.getElementById('settingsOcrOverwrite').checked
            };
            
            showLoading('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫...');
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
                        // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Å –ø–∞—Ä–æ–ª—è–º–∏
                        document.getElementById('settingsToken').value = '';
                        document.getElementById('settingsGeminiKey').value = '';
                    } else {
                        showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
                })
                .webApiSaveSettings(settings);
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ Gemini
        function sendGeminiRequest() {
            const prompt = document.getElementById('geminiPrompt').value;
            if (!prompt.trim()) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å', 'error');
                return;
            }
            
            const options = {
                maxTokens: parseInt(document.getElementById('geminiMaxTokens').value),
                temperature: parseFloat(document.getElementById('geminiTemperature').value)
            };
            
            showLoading('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ Gemini...');
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    const responseDiv = document.getElementById('geminiResponse');
                    
                    if (result.success) {
                        responseDiv.innerHTML = `
                            <div class="bg-white border-l-4 border-green-500 p-4 rounded">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-robot text-green-500 mr-2"></i>
                                    <span class="font-medium">–û—Ç–≤–µ—Ç Gemini:</span>
                                </div>
                                <div class="text-gray-800 whitespace-pre-wrap">${result.result}</div>
                            </div>
                        `;
                        showNotification('–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω!', 'success');
                    } else {
                        responseDiv.innerHTML = `
                            <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                                    <span class="font-medium">–û—à–∏–±–∫–∞:</span>
                                </div>
                                <div class="text-red-800">${result.error}</div>
                            </div>
                        `;
                        showNotification('–û—à–∏–±–∫–∞ Gemini', 'error');
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
                })
                .webApiGeminiRequest(prompt, options);
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —á–∞—Ç–∞ Gemini
        function clearGeminiChat() {
            document.getElementById('geminiPrompt').value = '';
            document.getElementById('geminiResponse').innerHTML = `
                <div class="text-center text-gray-500">
                    <i class="fas fa-comments text-2xl mb-2"></i>
                    <p>–û—Ç–≤–µ—Ç—ã Gemini –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å</p>
                </div>
            `;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü—ã
        function loadTableData() {
            const tableName = document.getElementById('tableSelector').value;
            
            showLoading('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    const container = document.getElementById('tableData');
                    
                    if (result.success && result.data.length > 0) {
                        let html = '<table><thead><tr>';
                        
                        // –ó–∞–≥–æ–ª–æ–≤–∫–∏
                        result.headers.forEach(header => {
                            html += `<th>${header}</th>`;
                        });
                        html += '</tr></thead><tbody>';
                        
                        // –î–∞–Ω–Ω—ã–µ
                        result.data.forEach(row => {
                            html += '<tr>';
                            row.forEach(cell => {
                                const cellText = String(cell || '').substring(0, 100);
                                html += `<td title="${cellText}">${cellText}</td>`;
                            });
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table>';
                        container.innerHTML = html;
                    } else {
                        container.innerHTML = `
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-inbox text-3xl mb-3"></i>
                                <p>${result.error || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ'}</p>
                            </div>
                        `;
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
                })
                .webApiGetTableData(tableName, 100);
        }
        
        // –¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        function testConnection() {
            showLoading('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...');
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        showNotification('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                        checkSystemStatus(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å—ã
                    } else {
                        showNotification('–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º: ' + result.error, 'error');
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showNotification('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ' + error.message, 'error');
                })
                .webApiTestConnection();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function refreshData() {
            showLoading('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            Promise.all([
                new Promise(resolve => {
                    google.script.run
                        .withSuccessHandler(resolve)
                        .getSystemStatusData();
                }),
                new Promise(resolve => {
                    google.script.run
                        .withSuccessHandler(resolve)
                        .getRecentResults();
                })
            ]).then(() => {
                hideLoading();
                loadDashboardData();
                checkSystemStatus();
                showNotification('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!', 'info');
            });
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function updateImportStatus(status) {
            document.getElementById('importStatus').innerHTML = `
                <div class="text-center py-4">
                    <i class="fas fa-sync fa-spin text-2xl mb-2 text-blue-500"></i>
                    <p>${status}</p>
                </div>
            `;
        }
        
        function updateOcrProgress(status) {
            document.getElementById('ocrProgress').innerHTML = `
                <div class="text-center py-4">
                    <i class="fas fa-check text-2xl mb-2 text-green-500"></i>
                    <p>${status}</p>
                </div>
            `;
        }
        
        function showLoading(message) {
            document.getElementById('loadingMessage').textContent = message;
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }
        
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // ========================================
        // AI CONSTRUCTOR FUNCTIONS
        // Integrated CollectConfigUI functionality into WebApp
        // ========================================
        
        let aiDataSourcesCount = 0;
        
        // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
        function addDataSource() {
            aiDataSourcesCount++;
            const container = document.getElementById('aiDataSources');
            
            // –û—á–∏—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏
            if (aiDataSourcesCount === 1) {
                container.innerHTML = '';
            }
            
            const sourceDiv = document.createElement('div');
            sourceDiv.className = 'flex space-x-2 items-center bg-gray-50 p-3 rounded border';
            sourceDiv.innerHTML = `
                <select class="ai-data-sheet flex-1" onchange="updateAIPreview()">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏—Å—Ç...</option>
                </select>
                <input type="text" class="ai-data-range flex-none w-24" placeholder="A1:B10" onchange="updateAIPreview()">
                <button type="button" onclick="removeDataSource(this)" class="btn-secondary text-sm px-2 py-1 flex-none">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(sourceDiv);
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –ª–∏—Å—Ç–æ–≤
            loadSheetOptions();
            updateAIPreview();
        }
        
        // –£–¥–∞–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
        function removeDataSource(button) {
            button.closest('div').remove();
            aiDataSourcesCount--;
            
            // –ï—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
            if (aiDataSourcesCount === 0) {
                document.getElementById('aiDataSources').innerHTML = `
                    <div class="text-sm text-gray-500 text-center py-2">
                        –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å" —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                    </div>
                `;
            }
            
            updateAIPreview();
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø—Ü–∏–∏ –ª–∏—Å—Ç–æ–≤
        function loadSheetOptions() {
            google.script.run
                .withSuccessHandler(function(sheets) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Å–µ–ª–µ–∫—Ç—ã –ª–∏—Å—Ç–æ–≤
                    const selects = [
                        'aiTargetSheet', 'aiSystemSheet',
                        ...Array.from(document.querySelectorAll('.ai-data-sheet'))
                    ];
                    
                    selects.forEach(select => {
                        if (typeof select === 'string') {
                            select = document.getElementById(select);
                        }
                        if (select) {
                            const currentValue = select.value;
                            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏—Å—Ç...</option>';
                            sheets.forEach(sheet => {
                                const option = document.createElement('option');
                                option.value = sheet;
                                option.textContent = sheet;
                                select.appendChild(option);
                            });
                            select.value = currentValue; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                        }
                    });
                })
                .withFailureHandler(function(error) {
                    console.error('Failed to load sheets:', error);
                })
                .getAllSheetNames();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        function updateAIPreview() {
            const targetSheet = document.getElementById('aiTargetSheet').value;
            const targetCell = document.getElementById('aiTargetCell').value;
            const systemSheet = document.getElementById('aiSystemSheet').value;
            const systemCell = document.getElementById('aiSystemCell').value;
            
            const dataSources = [];
            document.querySelectorAll('#aiDataSources > div').forEach(div => {
                const sheet = div.querySelector('.ai-data-sheet')?.value;
                const range = div.querySelector('.ai-data-range')?.value;
                if (sheet && range) {
                    dataSources.push(`${sheet}!${range}`);
                }
            });
            
            const preview = document.getElementById('aiConfigPreview');
            let html = '<div class="space-y-2">';
            
            html += '<div><strong>–¶–µ–ª–µ–≤–∞—è —è—á–µ–π–∫–∞:</strong> ';
            html += (targetSheet && targetCell) ? 
                `<span class="text-blue-600">${targetSheet}!${targetCell}</span>` : 
                '<span class="text-gray-400">–Ω–µ –∑–∞–¥–∞–Ω–∞</span>';
            html += '</div>';
            
            html += '<div><strong>System Prompt:</strong> ';
            html += (systemSheet && systemCell) ? 
                `<span class="text-green-600">${systemSheet}!${systemCell}</span>` : 
                '<span class="text-gray-400">–Ω–µ –∑–∞–¥–∞–Ω</span>';
            html += '</div>';
            
            html += `<div><strong>–ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö:</strong> <span class="text-purple-600">${dataSources.length}</span></div>`;
            
            if (dataSources.length > 0) {
                html += '<div class="text-sm text-gray-600 mt-2">';
                dataSources.forEach((source, i) => {
                    html += `<div>‚Ä¢ ${source}</div>`;
                });
                html += '</div>';
            }
            
            html += '</div>';
            preview.innerHTML = html;
        }
        
        // –í—ã–ø–æ–ª–Ω–∏—Ç—å AI –∑–∞–ø—Ä–æ—Å
        function executeAIConstructor() {
            const targetSheet = document.getElementById('aiTargetSheet').value;
            const targetCell = document.getElementById('aiTargetCell').value;
            const systemSheet = document.getElementById('aiSystemSheet').value;
            const systemCell = document.getElementById('aiSystemCell').value;
            
            if (!targetSheet || !targetCell) {
                showNotification('–£–∫–∞–∂–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é —è—á–µ–π–∫—É', 'error');
                return;
            }
            
            if (!systemSheet || !systemCell) {
                showNotification('–£–∫–∞–∂–∏—Ç–µ System Prompt', 'error');
                return;
            }
            
            const dataSources = [];
            let hasEmptySource = false;
            
            document.querySelectorAll('#aiDataSources > div').forEach(div => {
                const sheet = div.querySelector('.ai-data-sheet')?.value;
                const range = div.querySelector('.ai-data-range')?.value;
                if (sheet && range) {
                    dataSources.push({ sheet, range });
                } else if (div.querySelector('.ai-data-sheet')) {
                    hasEmptySource = true;
                }
            });
            
            if (dataSources.length === 0) {
                showNotification('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö', 'error');
                return;
            }
            
            if (hasEmptySource) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ –ø—É—Å—Ç—ã–µ', 'error');
                return;
            }
            
            const config = {
                targetSheet,
                targetCell,
                systemPrompt: { sheet: systemSheet, cell: systemCell },
                userData: dataSources
            };
            
            updateAIStatus('–ó–∞–ø—É—Å–∫ AI –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞...');
            showLoading('–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ AI –∑–∞–ø—Ä–æ—Å–∞...');
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        showNotification('AI –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                        updateAIStatus(`–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Å–∞–Ω –≤ ${targetSheet}!${targetCell}`);
                    } else {
                        showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
                        updateAIStatus('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ' + result.error);
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
                    updateAIStatus('–û—à–∏–±–∫–∞: ' + error.message);
                })
                .executeCollectConfig(targetSheet, targetCell, config);
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é AI
        function saveAIConfig() {
            const targetSheet = document.getElementById('aiTargetSheet').value;
            const targetCell = document.getElementById('aiTargetCell').value;
            
            if (!targetSheet || !targetCell) {
                showNotification('–£–∫–∞–∂–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é —è—á–µ–π–∫—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', 'error');
                return;
            }
            
            const config = {
                systemPrompt: {
                    sheet: document.getElementById('aiSystemSheet').value,
                    cell: document.getElementById('aiSystemCell').value
                },
                userData: []
            };
            
            document.querySelectorAll('#aiDataSources > div').forEach(div => {
                const sheet = div.querySelector('.ai-data-sheet')?.value;
                const range = div.querySelector('.ai-data-range')?.value;
                if (sheet && range) {
                    config.userData.push({ sheet, range });
                }
            });
            
            showLoading('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        showNotification('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 'success');
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + result.error, 'error');
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
                })
                .saveCollectConfig(targetSheet, targetCell, config);
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é AI
        function loadAIConfig() {
            const targetSheet = document.getElementById('aiTargetSheet').value;
            const targetCell = document.getElementById('aiTargetCell').value;
            
            if (!targetSheet || !targetCell) {
                showNotification('–£–∫–∞–∂–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é —è—á–µ–π–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', 'error');
                return;
            }
            
            showLoading('–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success && result.config) {
                        const config = result.config;
                        
                        // –ó–∞–ø–æ–ª–Ω—è–µ–º System Prompt
                        if (config.systemPrompt) {
                            document.getElementById('aiSystemSheet').value = config.systemPrompt.sheet || '';
                            document.getElementById('aiSystemCell').value = config.systemPrompt.cell || '';
                        }
                        
                        // –û—á–∏—â–∞–µ–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                        document.getElementById('aiDataSources').innerHTML = `
                            <div class="text-sm text-gray-500 text-center py-2">
                                –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å" —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                            </div>
                        `;
                        aiDataSourcesCount = 0;
                        
                        if (config.userData && config.userData.length > 0) {
                            config.userData.forEach(source => {
                                addDataSource();
                                const lastSource = document.querySelector('#aiDataSources > div:last-child');
                                lastSource.querySelector('.ai-data-sheet').value = source.sheet || '';
                                lastSource.querySelector('.ai-data-range').value = source.range || '';
                            });
                        }
                        
                        updateAIPreview();
                        showNotification('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞!', 'success');
                    } else {
                        showNotification(result.error || '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    }
                })
                .withFailureHandler(function(error) {
                    hideLoading();
                    showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
                })
                .loadCollectConfig(targetSheet, targetCell);
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å AI –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        function updateAIStatus(status) {
            document.getElementById('aiConstructorStatus').innerHTML = `
                <div class="text-center py-4">
                    <i class="fas fa-cogs text-2xl mb-2 text-blue-500"></i>
                    <p>${status}</p>
                </div>
            `;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AI –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–µ–π —Ü–µ–ª–µ–≤–æ–π —è—á–µ–π–∫–∏
            const targetSheetSelect = document.getElementById('aiTargetSheet');
            const targetCellInput = document.getElementById('aiTargetCell');
            const systemSheetSelect = document.getElementById('aiSystemSheet');
            const systemCellInput = document.getElementById('aiSystemCell');
            
            if (targetSheetSelect) targetSheetSelect.addEventListener('change', updateAIPreview);
            if (targetCellInput) targetCellInput.addEventListener('input', updateAIPreview);
            if (systemSheetSelect) systemSheetSelect.addEventListener('change', updateAIPreview);
            if (systemCellInput) systemCellInput.addEventListener('input', updateAIPreview);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ª–∏—Å—Ç–æ–≤ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
            setTimeout(loadSheetOptions, 1000);
        });
    </script>
</body>
</html>