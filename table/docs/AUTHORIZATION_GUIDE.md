# üîê –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏—Å—Ç–µ–º–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –≤ AI_TABLE.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
3. [–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](#—Ñ—É–Ω–∫—Ü–∏–∏-–¥–ª—è-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
4. [–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤](#—Ñ—É–Ω–∫—Ü–∏–∏-–¥–ª—è-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)
5. [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ OAuth —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- üöÄ –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- üé® –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–π UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- üìä –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- üß™ –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ OAuth Scopes

```javascript
- https://www.googleapis.com/auth/spreadsheets
- https://www.googleapis.com/auth/script.external_request
- https://www.googleapis.com/auth/script.container.ui
- https://www.googleapis.com/auth/script.scriptapp
- https://www.googleapis.com/auth/userinfo.email
```

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. **–ü—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ "insufficient permissions":**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –º–µ–Ω—é: `ü§ñ Table AI` ‚Üí `‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏` ‚Üí `üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π`
   - –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É `üöÄ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å`
   - –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
   ```
   –ú–µ–Ω—é ‚Üí ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
   ```

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   ```
   –ú–µ–Ω—é ‚Üí ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí üß™ –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   ```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

1. **–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è"**
2. **–í—ã–±–µ—Ä–∏—Ç–µ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"**
3. **–ù–∞–∂–º–∏—Ç–µ "–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ)"**
   - ‚ö†Ô∏è –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ! –°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
4. **–ù–∞–∂–º–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å"**

---

## –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–π HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å:
- –¢–µ–∫—É—â–∏–º —Å—Ç–∞—Ç—É—Å–æ–º –≤—Å–µ—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- –ö–Ω–æ–ø–∫–æ–π –∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –î–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π

```
–ú–µ–Ω—é ‚Üí ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
```

### üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø–æ—à–∞–≥–æ–≤—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏.

```
–ú–µ–Ω—é ‚Üí ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
```

### üß™ –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ
- Script App —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- Properties –¥–æ—Å—Ç—É–ø

```
–ú–µ–Ω—é ‚Üí ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí üß™ –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```

---

## –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### checkAuthorizationStatus()

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π.

```javascript
var status = checkAuthorizationStatus();

// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç:
{
  authorized: true/false,           // –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å
  needsAuthorization: true/false,   // –¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
  userEmail: "user@example.com",    // Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  spreadsheetAccess: true/false,    // –î–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–∞–º
  urlFetchAccess: true/false,       // –î–æ—Å—Ç—É–ø –∫ –≤–Ω–µ—à–Ω–∏–º –∑–∞–ø—Ä–æ—Å–∞–º
  errors: [],                       // –°–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫
  missingScopes: [],                // –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
  availableScopes: []               // –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
}
```

### initiateAuthorizationFlow()

–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å UI –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏.

```javascript
var success = initiateAuthorizationFlow();
if (success) {
  Logger.log('–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
} else {
  Logger.log('–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è');
}
```

### autoCheckAndAuthorize()

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

```javascript
if (autoCheckAndAuthorize()) {
  // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –ø–æ—Ä—è–¥–∫–µ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
  var email = Session.getActiveUser().getEmail();
} else {
  // –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ
  Logger.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å');
}
```

### withAuthorization(func, context, args)

Wrapper –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π, —Ç—Ä–µ–±—É—é—â–∏—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏.

```javascript
// –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è
var email = withAuthorization(function() {
  return Session.getActiveUser().getEmail();
});

// –ü—Ä–∏–º–µ—Ä 2: –§—É–Ω–∫—Ü–∏—è —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
var result = withAuthorization(
  function(arg1, arg2) {
    return someProtectedFunction(arg1, arg2);
  },
  this,
  ['value1', 'value2']
);

// –ü—Ä–∏–º–µ—Ä 3: –° –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
var obj = {
  data: 'test',
  getData: function() {
    return this.data;
  }
};

var data = withAuthorization(obj.getData, obj);
```

### safeExecute(func, defaultValue)

–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å –∞–≤—Ç–æ–æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

```javascript
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç email –∏–ª–∏ 'unknown' –ø—Ä–∏ –æ—à–∏–±–∫–µ
var email = safeExecute(
  function() {
    return Session.getActiveUser().getEmail();
  },
  'unknown'
);

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏
var userId = safeExecute(
  function() {
    return Session.getActiveUser().getEmail();
  },
  'anonymous'
);

Logger.log('User: ' + userId);
```

### isAuthorizationError(error)

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–±–ª–µ–º–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

```javascript
try {
  var email = Session.getActiveUser().getEmail();
} catch (error) {
  if (isAuthorizationError(error)) {
    // –≠—Ç–æ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    initiateAuthorizationFlow();
  } else {
    // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞
    Logger.log('Unexpected error: ' + error.message);
  }
}
```

### testAuthorization()

–í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

```javascript
var passed = testAuthorization();
if (passed) {
  Logger.log('–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!');
} else {
  Logger.log('–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏');
}
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ó–∞—â–∏—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```javascript
function logUserAction(action) {
  var email = safeExecute(
    function() {
      return Session.getActiveUser().getEmail();
    },
    'unknown'
  );
  
  Logger.log('[' + email + '] ' + action);
}
```

### –ü—Ä–∏–º–µ—Ä 2: –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º

```javascript
function getSheetData() {
  return withAuthorization(function() {
    var ss = SpreadsheetApp.getActiveSpreadsheet();
    var sheet = ss.getActiveSheet();
    return sheet.getDataRange().getValues();
  });
}
```

### –ü—Ä–∏–º–µ—Ä 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```javascript
function processData() {
  try {
    var data = getProtectedData();
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  } catch (error) {
    if (isAuthorizationError(error)) {
      Logger.log('–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è');
      var success = initiateAuthorizationFlow();
      if (success) {
        // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–ø—ã—Ç–∫—É
        return processData();
      }
    } else {
      throw error;
    }
  }
}
```

### –ü—Ä–∏–º–µ—Ä 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º

```javascript
function criticalOperation() {
  var status = checkAuthorizationStatus();
  
  if (!status.authorized) {
    Logger.log('–û—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + status.errors.join(', '));
    initiateAuthorizationFlow();
    return;
  }
  
  // –í—ã–ø–æ–ª–Ω—è–µ–º –∫—Ä–∏—Ç–∏—á–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
  var email = Session.getActiveUser().getEmail();
  Logger.log('–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –æ—Ç –∏–º–µ–Ω–∏: ' + email);
}
```

---

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "insufficient permissions"

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏` ‚Üí `üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π`
2. –ù–∞–∂–º–∏—Ç–µ `üöÄ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º

### –î–∏–∞–ª–æ–≥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –ª–∏ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª—é–±—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ –º–µ–Ω—é
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `üß™ –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "unknown"

**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç OAuth scope `userinfo.email`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `appsscript.json` - –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
   ```json
   "https://www.googleapis.com/auth/userinfo.email"
   ```
2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ –º–µ–Ω—é

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ HTML –¥–∏–∞–ª–æ–≥–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `table/web/AuthorizationDialog.html` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: `üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é`

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥

### –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```javascript
// –í –Ω–∞—á–∞–ª–µ –≤–∞—à–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
function globalErrorHandler(error) {
  if (isAuthorizationError(error)) {
    autoCheckAndAuthorize();
    return true; // –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞
  }
  return false; // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
try {
  // –í–∞—à –∫–æ–¥
} catch (error) {
  if (!globalErrorHandler(error)) {
    throw error;
  }
}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

```javascript
function onOpen() {
  // –¢–∏—Ö–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  if (typeof checkAuthorizationStatus === 'function') {
    var status = checkAuthorizationStatus();
    if (!status.authorized) {
      Logger.log('‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: ' + status.errors.join(', '));
    }
  }
  
  // –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω—é –∏ —Ç.–¥.
}
```

---

## API Reference

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
|---------|----------|------------|
| `checkAuthorizationStatus()` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ | Object |
| `initiateAuthorizationFlow()` | –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ | Boolean |
| `autoCheckAndAuthorize()` | –ê–≤—Ç–æ-–ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | Boolean |
| `testAuthorization()` | –¢–µ—Å—Ç –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ | Boolean |
| `showAuthorizationStatus()` | –ü–æ–∫–∞–∑–∞—Ç—å UI —Å—Ç–∞—Ç—É—Å–∞ | void |
| `openAuthorizationDialog()` | –û—Ç–∫—Ä—ã—Ç—å HTML –¥–∏–∞–ª–æ–≥ | void |

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
|---------|----------|------------|
| `withAuthorization(func, context, args)` | Wrapper —Å –∞–≤—Ç–æ-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π | Any |
| `safeExecute(func, defaultValue)` | –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ | Any |
| `isAuthorizationError(error)` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏ | Boolean |
| `triggerAuthorizationDialog_()` | –¢—Ä–∏–≥–≥–µ—Ä –¥–∏–∞–ª–æ–≥–∞ (internal) | Boolean |

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º—É:

```javascript
// –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
addSystemLog('Authorization successful', 'INFO', 'AUTH');

// –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
addSystemLog('Authorization error: ' + error.message, 'ERROR', 'AUTH');

// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
addSystemLog('Auto-detected authorization issue', 'WARN', 'AUTH');
```

–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```
–ú–µ–Ω—é ‚Üí üß∞ DEV ‚Üí üìã –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ª–æ–≥–∏
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã —Å–∫—Ä–∏–ø—Ç—É?

–°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ —Å –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏**:
- ‚úÖ Email —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –î–∞–Ω–Ω—ã–µ –≤ —Ç–µ–∫—É—â–µ–π —Ç–∞–±–ª–∏—Ü–µ
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ (PropertiesService)
- ‚ùå –ù–∏–∫–∞–∫–∏–µ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ Google –∞–∫–∫–∞—É–Ω—Ç–∞

### –ü–æ—á–µ–º—É Google –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ"?

Google –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–ª—è **–≤—Å–µ—Ö** –Ω–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤. –≠—Ç–æ –Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –æ–ø–∞—Å–µ–Ω - —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω –Ω–µ –ø—Ä–æ—à–µ–ª –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É Google (–∫–æ—Ç–æ—Ä–∞—è —Å—Ç–æ–∏—Ç $75,000+ –≤ –≥–æ–¥).

### –ú–æ–∂–Ω–æ –ª–∏ –¥–æ–≤–µ—Ä—è—Ç—å?

- ‚úÖ –í–µ—Å—å –∫–æ–¥ –æ—Ç–∫—Ä—ã—Ç - –≤—ã –º–æ–∂–µ—Ç–µ –µ–≥–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
- ‚úÖ –°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –≤–∞—à–µ–º Google Apps Script –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- ‚úÖ –ù–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä—ã
- ‚úÖ –í—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç–µ –∫–æ–¥

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```
   –ú–µ–Ω—é ‚Üí üß∞ DEV ‚Üí üìã –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ª–æ–≥–∏
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:**
   ```
   –ú–µ–Ω—é ‚Üí ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí üß™ –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   ```

3. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å:**
   ```
   –ú–µ–Ω—é ‚Üí ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
   ```

4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - [INSTALLATION.md](./INSTALLATION.md)
   - [QUICK_START.md](./QUICK_START.md)

---

**–í–µ—Ä—Å–∏—è:** 2.1.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-23
