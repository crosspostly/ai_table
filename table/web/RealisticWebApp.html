<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Table AI Bot - –ü—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</title>
    <style>
        /* –í–°–¢–†–û–ï–ù–ù–´–ô CSS - —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Google Apps Script */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            color: #1a73e8;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        
        .section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #1a73e8;
            padding-bottom: 5px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .btn {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #1557b0;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom-color: #1a73e8;
            color: #1a73e8;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }
        
        th {
            background: #f8f9fa;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Table AI Bot</h1>
            <p>–ü—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</p>
        </div>
        
        <!-- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã -->
        <div class="section">
            <h3>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h3>
            <div id="systemStatus" class="status info">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã...</div>
            <button onclick="checkStatus()" class="btn btn-secondary">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('social')">üì± –°–æ—Ü–∏–∞–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç</div>
            <div class="tab" onclick="showTab('ocr')">üëÅÔ∏è OCR –∞–Ω–∞–ª–∏–∑</div>
            <div class="tab" onclick="showTab('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        </div>
        
        <!-- –°–æ—Ü–∏–∞–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç -->
        <div id="tab-social" class="tab-content active">
            <div class="section">
                <h3>üì± –ò–º–ø–æ—Ä—Ç –ø–æ—Å—Ç–æ–≤</h3>
                <div class="form-group">
                    <label>–ò—Å—Ç–æ—á–Ω–∏–∫ (URL –∏–ª–∏ ID):</label>
                    <input type="text" id="socialSource" placeholder="https://vk.com/durov –∏–ª–∏ @username">
                </div>
                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤:</label>
                    <input type="number" id="socialCount" value="10" min="1" max="50">
                </div>
                <div class="form-group">
                    <label>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</label>
                    <select id="socialPlatform">
                        <option value="">–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</option>
                        <option value="vk">VKontakte</option>
                        <option value="instagram">Instagram</option>
                        <option value="telegram">Telegram</option>
                    </select>
                </div>
                <button onclick="runSocialImport()" class="btn">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç</button>
                <div id="importResult" class="loading" style="display:none;">–ò–º–ø–æ—Ä—Ç –∑–∞–ø—É—â–µ–Ω...</div>
            </div>
        </div>
        
        <!-- OCR –∞–Ω–∞–ª–∏–∑ -->
        <div id="tab-ocr" class="tab-content">
            <div class="section">
                <h3>üëÅÔ∏è OCR –∞–Ω–∞–ª–∏–∑ –æ—Ç–∑—ã–≤–æ–≤</h3>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="ocrOverwrite"> –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    </label>
                </div>
                <button onclick="runOcrAnalysis()" class="btn">–ó–∞–ø—É—Å—Ç–∏—Ç—å OCR</button>
                <div id="ocrResult" class="loading" style="display:none;">–ê–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω...</div>
            </div>
        </div>
        
        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div id="tab-settings" class="tab-content">
            <div class="section">
                <h3>‚öôÔ∏è API –∫–ª—é—á–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <div class="form-group">
                    <label>Email –ª–∏—Ü–µ–Ω–∑–∏–∏:</label>
                    <input type="email" id="settingsEmail">
                </div>
                <div class="form-group">
                    <label>Token –ª–∏—Ü–µ–Ω–∑–∏–∏:</label>
                    <input type="password" id="settingsToken">
                </div>
                <div class="form-group">
                    <label>Gemini API Key:</label>
                    <input type="password" id="settingsGemini">
                </div>
                <button onclick="saveSettings()" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <div id="settingsResult" class="loading" style="display:none;">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</div>
            </div>
        </div>
        
        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div class="section">
            <h3>üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
            <div id="recentResults">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
            </div>
            <button onclick="loadRecentData()" class="btn btn-secondary">–û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
    </div>

    <script>
        // –ë–ê–ó–û–í–´–ô JavaScript - —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Google Apps Script
        
        function showTab(tabName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        function showResult(elementId, message, isError) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = isError ? 'status error' : 'status success';
            element.textContent = message;
        }
        
        function hideResult(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }
        
        // –ü—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è Google Apps Script
        function checkStatus() {
            document.getElementById('systemStatus').textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';
            
            google.script.run
                .withSuccessHandler(function(status) {
                    const statusDiv = document.getElementById('systemStatus');
                    if (status.success) {
                        statusDiv.className = 'status success';
                        statusDiv.textContent = '‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ';
                    } else {
                        statusDiv.className = 'status error';
                        statusDiv.textContent = '‚ùå ' + status.error;
                    }
                })
                .withFailureHandler(function(error) {
                    document.getElementById('systemStatus').className = 'status error';
                    document.getElementById('systemStatus').textContent = '‚ùå –û—à–∏–±–∫–∞: ' + error.message;
                })
                .webApiTestConnection();
        }
        
        function runSocialImport() {
            const source = document.getElementById('socialSource').value;
            const count = document.getElementById('socialCount').value;
            const platform = document.getElementById('socialPlatform').value;
            
            if (!source || !count) {
                showResult('importResult', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', true);
                return;
            }
            
            showResult('importResult', '–ó–∞–ø—É—Å–∫ –∏–º–ø–æ—Ä—Ç–∞...', false);
            
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result.success) {
                        showResult('importResult', '–ò–º–ø–æ—Ä—Ç –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ!', false);
                    } else {
                        showResult('importResult', '–û—à–∏–±–∫–∞: ' + result.error, true);
                    }
                })
                .withFailureHandler(function(error) {
                    showResult('importResult', '–û—à–∏–±–∫–∞: ' + error.message, true);
                })
                .webApiSocialImport({
                    source: source,
                    count: parseInt(count),
                    platform: platform
                });
        }
        
        function runOcrAnalysis() {
            const overwrite = document.getElementById('ocrOverwrite').checked;
            
            showResult('ocrResult', '–ó–∞–ø—É—Å–∫ OCR –∞–Ω–∞–ª–∏–∑–∞...', false);
            
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result.success) {
                        showResult('ocrResult', 'OCR –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!', false);
                    } else {
                        showResult('ocrResult', '–û—à–∏–±–∫–∞: ' + result.error, true);
                    }
                })
                .withFailureHandler(function(error) {
                    showResult('ocrResult', '–û—à–∏–±–∫–∞: ' + error.message, true);
                })
                .webApiOcrAnalysis({overwrite: overwrite});
        }
        
        function saveSettings() {
            const email = document.getElementById('settingsEmail').value;
            const token = document.getElementById('settingsToken').value;
            const gemini = document.getElementById('settingsGemini').value;
            
            showResult('settingsResult', '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫...', false);
            
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result.success) {
                        showResult('settingsResult', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', false);
                        // –û—á–∏—Å—Ç–∏—Ç—å –ø–∞—Ä–æ–ª–∏
                        document.getElementById('settingsToken').value = '';
                        document.getElementById('settingsGemini').value = '';
                    } else {
                        showResult('settingsResult', '–û—à–∏–±–∫–∞: ' + result.error, true);
                    }
                })
                .withFailureHandler(function(error) {
                    showResult('settingsResult', '–û—à–∏–±–∫–∞: ' + error.message, true);
                })
                .webApiSaveSettings({
                    email: email,
                    token: token,
                    geminiKey: gemini
                });
        }
        
        function loadRecentData() {
            document.getElementById('recentResults').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            
            google.script.run
                .withSuccessHandler(function(results) {
                    const container = document.getElementById('recentResults');
                    if (results && results.length > 0) {
                        let html = '<table><tr><th>–¢–∏–ø</th><th>–ò—Å—Ç–æ—á–Ω–∏–∫</th><th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th></tr>';
                        results.forEach(function(result) {
                            html += `<tr>
                                <td>${result.type}</td>
                                <td>${result.source}</td>
                                <td>${result.result}</td>
                            </tr>`;
                        });
                        html += '</table>';
                        container.innerHTML = html;
                    } else {
                        container.innerHTML = '<div class="status info">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
                    }
                })
                .withFailureHandler(function(error) {
                    document.getElementById('recentResults').innerHTML = '<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message + '</div>';
                })
                .getRecentResults();
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        document.addEventListener('DOMContentLoaded', function() {
            checkStatus();
            loadRecentData();
        });
    </script>
</body>
</html>